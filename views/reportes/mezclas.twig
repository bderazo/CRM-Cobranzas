{% extends 'layout.twig' %}
{% block content %}
	{% include "reportes/filtrosMezclas.twig" %}
	<div class="ibox float-e-margins" id="app">
		<div class="ibox-title">
			<h5>
				<strong>Datos</strong>
			</h5>

			<div class="ibox-tools">
				<a class="btn" id="btnExportarPdf">
					<i class="far fa-file-pdf"></i>
					Exportar PDF
				</a>

			</div>
		</div>
		<div class="ibox-content no-padding">
			<div class="row">
				<div class="col-lg-12">
					<table class="table table-condensed table-bordered table-stripped">
						<thead>
						<tr>
							<th>Fecha</th>
							<th>Orden</th>
							<th>FÃ³rmula</th>
							<th>Cliente</th>
							<th>%B</th>
							<th>Materiales B</th>
							<th>%A</th>
							<th>Materiales A</th>
							<th>%C</th>
							<th>Materiales C</th>
						</tr>
						</thead>
						<tbody>
						<tr v-for="d in datos">
							<td v-html="d.fecha"></td>
							<td>
								<a :href="'{{ root }}/ordenExtrusion/editar?id=' + d.id" target="_blank">
									<span v-html="d.numero"></span>
								</a>
							</td>
							<td>
								<a :href="'{{ root }}/formula/editar?id=' + d.id_formula" target="_blank">
									<span v-html="d.nombre_formula"></span>
								</a>
							</td>
							<td>
								<a :href="'{{ root }}/clientes/editar?id=' + d.id_cliente" target="_blank">
									<span v-html="d.nombre_cliente"></span>
								</a>
							</td>
							<td align="center" v-html="d.porcentaje_b"></td>
							<td>
								<table class="table table-condensed table-bordered table-stripped">
									<tbody>
									<tr>
										<td style="border-bottom: 1px solid #DDDDDD; background-color: #F5F5F6">Material</td>
										<td style="border-bottom: 1px solid #DDDDDD; background-color: #F5F5F6">%</td>
									</tr>
									<tr v-for="dm in d.material_extrusion_b">
										<td v-html="dm.porcentaje"></td>
										<td v-html="dm.material"></td>
									</tr>
									</tbody>
								</table>
							</td>
							<td align="center" v-html="d.porcentaje_a"></td>
							<td>
								<table class="table table-condensed table-bordered table-stripped">
									<tbody>
									<tr>
										<td style="border-bottom: 1px solid #DDDDDD; background-color: #F5F5F6">Material</td>
										<td style="border-bottom: 1px solid #DDDDDD; background-color: #F5F5F6">%</td>
									</tr>
									<tr v-for="dm in d.material_extrusion_a">
										<td v-html="dm.porcentaje"></td>
										<td v-html="dm.material"></td>
									</tr>
									</tbody>
								</table>
							</td>
							<td align="center" v-html="d.porcentaje_c"></td>
							<td>
								<table class="table table-condensed table-bordered table-stripped">
									<tbody>
									<tr>
										<td style="border-bottom: 1px solid #DDDDDD; background-color: #F5F5F6">%</td>
										<td style="border-bottom: 1px solid #DDDDDD; background-color: #F5F5F6">Material</td>
									</tr>

									<tr v-for="dm in d.material_extrusion_c">
										<td v-html="dm.porcentaje"></td>
										<td v-html="dm.material"></td>
									</tr>
									</tbody>
								</table>
							</td>
						</tr>
						</tbody>
					</table>

				</div>
			</div>

		</div>
	</div>

	<form id="exportForm" method="POST" action="{{ root }}/reportes/exportMezclas">
		<input type="hidden" id="json" name="json"/>
	</form>
	<form id="exportFormPdf" method="POST" action="{{ root }}/reportes/pdfMezclas">
		<input type="hidden" id="jsonPdf" name="jsonPdf"/>
	</form>

	{#<script src="http://d3js.org/d3.v3.min.js"></script>#}
	{{ bundle('validate') }}
	{{ bundle('boot_select') }}
	{{ script('js/highcharts/highcharts.js') }}
	{{ script('js/highcharts/modules/exporting.js') }}
	{{ script('js/jquery.serialize-object.min.js') }}

	<script type="text/javascript">
		var app = new Vue({
			el: '#app',
			data: {
				datos: [],
				total: []
			},
			watch: {},
			computed: {},
			methods: {
				consultar: function () {
					var form = $('#filtros');
					var self = this;
					var data = form.serializeArray();
					toggleLoader();
					$.post('{{ root }}/reportes/mezclas', data, function (res) {
						toggleLoader();
						self.datos = res['data'];
						self.total = res['total'];
						console.log(res['data']);
					})
				}
			},
			mounted: function () {
				var form = $('#filtros');
				var self = this;
				$('#btnExportar').click(function () {
					var data = {
						filtros: form.serializeForm()
					};
					$('#json').val(JSON.stringify(data));
					$('#exportForm').submit();
				});
				$('#btnExportarPdf').click(function () {
					var data = {
						filtros: form.serializeForm()
					};
					$('#jsonPdf').val(JSON.stringify(data));
					$('#exportFormPdf').submit();
				});

				$(document).ready(function () {
					$('#btnFiltro').click(function () {
						self.consultar();
					});
					$('#btnTodos').click(function () {
						form[0].reset();
						self.consultar();
					});
					self.consultar();
				});
			}
		});
	</script>
{% endblock %}