{% extends 'layout.twig' %}
{% block content %}
	{% include "reportes/filtrosKardexMovimientos.twig" %}
	<div class="ibox float-e-margins" id="app">
		<div class="ibox-title">
			<div class="ibox-tools">
				<a class="btn" id="btnExportar">
					<i class="far fa-file-excel"></i>
					Exportar Excel
				</a>
				<a class="btn" id="btnExportarPdf">
					<i class="far fa-file-pdf"></i>
					Exportar PDF
				</a>
			</div>
		</div>
		<div class="ibox-content no-padding">
			<div class="row">
				<div class="col-lg-12">

					<h1><strong><span v-html="nombre"></span></strong></h1>
					<table class="table table-condensed table-bordered table-stripped">
						<tr>
							<td><strong>Unidad:</strong></td>
							<td><span v-html="unidad"></span></td>
							<td><strong>Stock Actual:</strong></td>
							<td><span v-html="stock_actual"></span></td>
							<td><strong>Costo Actual:</strong></td>
							<td>$<span v-html="costo_actual"></span></td>
						</tr>
					</table>

					<div v-if="tipo_consulta == 'materiales'">
						<table class="table table-condensed table-bordered table-stripped">
							<thead>
							<tr>
								<th rowspan="2">FECHA</th>
								<th rowspan="2">DESCRIPCIÓN</th>
								<th colspan="3" style="text-align:center;">INGRESO</th>
								<th colspan="3" style="text-align:center;">EGRESO</th>
								<th colspan="3" style="text-align:center;">SALDO</th>
							</tr>
							<tr>
								<th>CANTIDAD</th>
								<th>COSTO</th>
								<th>SALDO</th>
								<th>CANTIDAD</th>
								<th>COSTO</th>
								<th>SALDO</th>
								<th>CANTIDAD</th>
								<th>COSTO</th>
								<th>SALDO</th>
							</tr>
							</thead>
							<tbody>
							<tr v-for="d in datos">
								<td v-html="d.fecha"></td>
								<td>
									<div v-if="d.tipo == 'COMPRA'">
										<a :href="'{{ root }}/compra/editar?id=' + d.id_registro" target="_blank">
											<span v-html="d.tipo"></span> <span
													v-html="d.numero_movimiento"></span><br/>
											<span v-html="d.proveedor"></span>
										</a>
									</div>
									<div v-if="d.tipo == 'DESPACHO'">
										<a :href="'{{ root }}/despachoProduccion/editar?id=' + d.id_registro"
										   target="_blank">
											<span v-html="d.tipo"></span> <span
													v-html="d.numero_movimiento"></span><br/>
										</a>
									</div>
									<div v-if="d.tipo == 'REINGRESO'">
										<a :href="'{{ root }}/reingreso/editar?id=' + d.id_registro" target="_blank">
											<span v-html="d.tipo"></span> <span
													v-html="d.numero_movimiento"></span><br/>
										</a>
									</div>
								</td>
								<td align="right">
									<div v-if="d.cantidad_ingreso > 0">
										<span v-html="d.cantidad_ingreso"></span> <span v-html="unidad"></span>
									</div>
								</td>
								<td align="right">
									<div v-if="d.cantidad_ingreso > 0">
										$<span v-html="d.costo_ingreso"></span>
									</div>
								</td>
								<td align="right">
									<div v-if="d.cantidad_ingreso > 0">
										<span v-html="d.saldo_ingreso"></span>
									</div>
								</td>
								<td align="right">
									<div v-if="d.cantidad_egreso > 0">
										<span v-html="d.cantidad_egreso"></span> <span v-html="unidad"></span>
									</div>
								</td>
								<td align="right">
									<div v-if="d.cantidad_egreso > 0">
										$<span v-html="d.costo_egreso"></span>
									</div>
								</td>
								<td align="right">
									<div v-if="d.cantidad_egreso > 0">
										<span v-html="d.saldo_egreso"></span>
									</div>
								</td>
								<td align="right">
									<span v-html="d.cantidad_saldo"></span> <span v-html="unidad"></span>
								</td>
								<td align="right">
									$<span v-html="d.costo_saldo"></span>
								</td>
								<td align="right">
									<span v-html="d.saldo_saldo"></span>
								</td>
							</tr>
							</tbody>
						</table>
					</div>

					<div v-else-if="tipo_consulta == 'desperdicio'">
						<table class="table table-condensed table-bordered table-stripped">
						<thead>
						<tr>
							<th rowspan="2">FECHA</th>
							<th rowspan="2">DESCRIPCIÓN</th>
							<th rowspan="2">TIPO</th>
							<th colspan="3" style="text-align:center;">INGRESO</th>
							<th colspan="3" style="text-align:center;">EGRESO</th>
							<th colspan="3" style="text-align:center;">SALDO</th>
						</tr>
						<tr>
							<th>CANTIDAD</th>
							<th>COSTO</th>
							<th>SALDO</th>
							<th>CANTIDAD</th>
							<th>COSTO</th>
							<th>SALDO</th>
							<th>CANTIDAD</th>
							<th>COSTO</th>
							<th>SALDO</th>
						</tr>
						</thead>
						<tbody>
						<tr v-for="d in datos">
							<td v-html="d.fecha"></td>
							<td>
								<div v-if="d.tipo == 'PRODUCCION'">
									<a :href="'{{ root }}/produccionExtrusion/editar?id=' + d.id_registro"
									   target="_blank">
										<span v-html="d.tipo"></span> <span v-html="d.numero_movimiento"></span><br/>
									</a>
								</div>
								<div v-if="d.tipo == 'PROCESO_INCONFORMES'">
									<a :href="'{{ root }}/produccionExtrusion/editar?id=' + d.id_registro"
									   target="_blank">
										<span v-html="d.tipo"></span> <span v-html="d.numero_movimiento"></span><br/>
									</a>
								</div>
								<div v-if="d.tipo == 'GENERAR_DESPERDICIO'">
									<a :href="'{{ root }}/generarDesperdicio/editar?id=' + d.id_registro"
									   target="_blank">
										<span v-html="d.tipo"></span> <span v-html="d.numero_movimiento"></span><br/>
									</a>
								</div>
								<div v-if="d.tipo == 'REPROCESO'">
									<a :href="'{{ root }}/produccionExtrusion/editar?id=' + d.id_registro"
									   target="_blank">
										<span v-html="d.tipo"></span> <span v-html="d.numero_movimiento"></span><br/>
									</a>
								</div>
								<div v-if="d.tipo == 'DESPACHO_INTERNO'">
									<span v-html="d.tipo"></span> <span v-html="d.numero_movimiento"></span><br/>
								</div>
							</td>
							<td style="text-transform: uppercase;" v-html="d.tipo_desperdicio"></td>
							<td align="right">
								<div v-if="d.cantidad_ingreso > 0">
									<span v-html="d.cantidad_ingreso"></span> KILOS</span>
								</div>
							</td>
							<td align="right">
								<div v-if="d.cantidad_ingreso > 0">
									$<span v-html="d.costo_ingreso"></span>
								</div>
							</td>
							<td align="right">
								<div v-if="d.cantidad_ingreso > 0">
									<span v-html="d.saldo_ingreso"></span>
								</div>
							</td>
							<td align="right">
								<div v-if="d.cantidad_egreso > 0">
									<span v-html="d.cantidad_egreso"></span> KILOS</span>
								</div>
							</td>
							<td align="right">
								<div v-if="d.cantidad_egreso > 0">
									$<span v-html="d.costo_egreso"></span>
								</div>
							</td>
							<td align="right">
								<div v-if="d.cantidad_egreso > 0">
									<span v-html="d.saldo_egreso"></span>
								</div>
							</td>
							<td align="right">
								<span v-html="d.cantidad_saldo"></span> KILOS</span>
							</td>
							<td align="right">
								$<span v-html="d.costo_saldo"></span>
							</td>
							<td align="right">
								<span v-html="d.saldo_saldo"></span>
							</td>
						</tr>
						</tbody>
						</table>
					</div>

					<div v-else>
						<table class="table table-condensed table-bordered table-stripped">
							<thead>
							<tr>
								<th rowspan="2">FECHA</th>
								<th rowspan="2">DESCRIPCIÓN</th>
								<th colspan="3" style="text-align:center;">INGRESO</th>
								<th colspan="3" style="text-align:center;">EGRESO</th>
								<th colspan="3" style="text-align:center;">SALDO</th>
							</tr>
							<tr>
								<th>CANTIDAD</th>
								<th>COSTO</th>
								<th>SALDO</th>
								<th>CANTIDAD</th>
								<th>COSTO</th>
								<th>SALDO</th>
								<th>CANTIDAD</th>
								<th>COSTO</th>
								<th>SALDO</th>
							</tr>
							</thead>
							<tbody>
							<tr v-for="d in datos">
								<td v-html="d.fecha"></td>
								<td>
									<div v-if="d.tipo == 'PRODUCCION'">
										<a :href="'{{ root }}/produccionExtrusion/editar?id=' + d.id_registro" target="_blank">
											<span v-html="d.tipo"></span> <span v-html="d.numero_movimiento"></span><br/>
										</a>
										<a :href="'{{ root }}/ingresoProductoTerminado/editar?id=' + d.ingreso_producto_terminado_id" target="_blank">
											<span v-html="d.ingreso_producto_terminado"></span><br/>
										</a>
									</div>
									<div v-if="d.tipo == 'DESPACHO_PRODUCTO_TERMINADO'">
										<a :href="'{{ root }}/despachoProductoTerminado/despachar?id_pedido=' + d.id_registro"
										   target="_blank">
											<span v-html="d.tipo"></span> <span v-html="d.numero_movimiento"></span><br/>
											<span v-html="d.cliente"></span>
										</a>
									</div>
									<div v-if="d.tipo == 'DESPACHO_PRODUCCION'">
										<a :href="'{{ root }}/produccionCB/editar?id=' + d.id_registro" target="_blank">
											<span v-html="d.tipo"></span> <span
													v-html="d.numero_movimiento"></span><br/>
										</a>
									</div>
									<div v-if="d.tipo == 'GENERAR_PERCHA'">
										<a :href="'{{ root }}/generarPercha/editar?id=' + d.id_registro"
										   target="_blank">
											<span v-html="d.tipo"></span> <span
													v-html="d.numero_movimiento"></span><br/>
										</a>
									</div>
									<div v-if="d.tipo == 'GENERAR_DESPERDICIO'">
										<a :href="'{{ root }}/generarDesperdicio/editar?id=' + d.id_registro"
										   target="_blank">
											<span v-html="d.tipo"></span> <span
													v-html="d.numero_movimiento"></span><br/>
										</a>
									</div>
									<div v-if="d.tipo == 'DEVOLUCION'">
										<a :href="'{{ root }}/devolucion/editar?id=' + d.id_registro" target="_blank">
											<span v-html="d.tipo"></span> <span
													v-html="d.numero_movimiento"></span><br/>
										</a>
									</div>
									<div v-if="d.tipo == 'PRODUCCION_CORTE'">
										<a :href="'{{ root }}/produccionCB/editarCorte?id=' + d.id_registro" target="_blank">
											<span v-html="d.tipo"></span> <span v-html="d.numero_movimiento"></span><br/>
										</a>
										<a :href="'{{ root }}/ingresoProductoTerminado/editar?id=' + d.ingreso_producto_terminado_id" target="_blank">
											<span v-html="d.ingreso_producto_terminado"></span><br/>
										</a>
									</div>
									<div v-if="d.tipo == 'PRODUCCION_CB'">
										<a :href="'{{ root }}/produccionCB/editar?id=' + d.id_registro" target="_blank">
											<span v-html="d.tipo"></span> <span v-html="d.numero_movimiento"></span><br/>
										</a>
										<a :href="'{{ root }}/ingresoProductoTerminado/editar?id=' + d.ingreso_producto_terminado_id" target="_blank">
											<span v-html="d.ingreso_producto_terminado"></span><br/>
										</a>
									</div>
									<div v-if="d.tipo == 'TRANSFORMAR_ROLLOS'">
										<a :href="'{{ root }}/transformarRollos/editar?id=' + d.id_registro"
										   target="_blank">
											<span v-html="d.tipo"></span> <span
													v-html="d.numero_movimiento"></span><br/>
										</a>
									</div>
									<div v-if="d.tipo == 'DEVOLUCION_PRODUCCION'">
										<a :href="'{{ root }}/produccionCB/editar?id=' + d.id_registro" target="_blank">
											<span v-html="d.tipo"></span> <span
													v-html="d.numero_movimiento"></span><br/>
										</a>
									</div>
									<div v-if="d.tipo == 'PROCESO_INCONFORME'">
										<a :href="'{{ root }}/produccionExtrusion/editar?id=' + d.id_registro"
										   target="_blank">
											<span v-html="d.tipo"></span> <span
													v-html="d.numero_movimiento"></span><br/>
										</a>
									</div>
									<div v-if="d.tipo == 'REPROCESO_EXTRUSION'">
										<a :href="'{{ root }}/produccionExtrusion/editar?id=' + d.id_registro"
										   target="_blank">
											<span v-html="d.tipo"></span> <span
													v-html="d.numero_movimiento"></span><br/>
										</a>
									</div>
									<div v-if="d.tipo == 'PROCESO_INCONFORME_CB'">
										<a :href="'{{ root }}/produccionCB/editar?id=' + d.id_registro" target="_blank">
											<span v-html="d.tipo"></span> <span
													v-html="d.numero_movimiento"></span><br/>
										</a>
									</div>
									<div v-if="d.tipo == 'DESPACHO_INCONFORME_CB'">
										<a :href="'{{ root }}/produccionCB/editar?id=' + d.id_registro" target="_blank">
											<span v-html="d.tipo"></span> <span
													v-html="d.numero_movimiento"></span><br/>
										</a>
									</div>
									<div v-if="d.tipo == 'DESPACHO_INCONFORME_EXTRUSION'">
										<a :href="'{{ root }}/produccionExtrusion/editar?id=' + d.id_registro"
										   target="_blank">
											<span v-html="d.tipo"></span> <span
													v-html="d.numero_movimiento"></span><br/>
										</a>
									</div>
								</td>
								<td align="right">
									<div v-if="d.cantidad_ingreso > 0">
										<span v-html="d.cantidad_ingreso"></span> <span v-html="unidad"></span>
									</div>
								</td>
								<td align="right">
									<div v-if="d.cantidad_ingreso > 0">
										$<span v-html="d.costo_ingreso"></span>
									</div>
								</td>
								<td align="right">
									<div v-if="d.cantidad_ingreso > 0">
										<span v-html="d.saldo_ingreso"></span>
									</div>
								</td>
								<td align="right">
									<div v-if="d.cantidad_egreso > 0">
										<span v-html="d.cantidad_egreso"></span> <span v-html="unidad"></span>
									</div>
								</td>
								<td align="right">
									<div v-if="d.cantidad_egreso > 0">
										$<span v-html="d.costo_egreso"></span>
									</div>
								</td>
								<td align="right">
									<div v-if="d.cantidad_egreso > 0">
										<span v-html="d.saldo_egreso"></span>
									</div>
								</td>
								<td align="right">
									<span v-html="d.cantidad_saldo"></span> <span v-html="unidad"></span>
								</td>
								<td align="right">
									$<span v-html="d.costo_saldo"></span>
								</td>
								<td align="right">
									<span v-html="d.saldo_saldo"></span>
								</td>
							</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>

	<form id="exportForm" method="POST" action="{{ root }}/reportes/exportVentasDetallado">
		<input type="hidden" id="json" name="json"/>
	</form>
	<form id="exportFormPdf" method="POST" action="{{ root }}/reportes/pdfVentasDetallado">
		<input type="hidden" id="jsonPdf" name="jsonPdf"/>
	</form>

	{# <script src="http://d3js.org/d3.v3.min.js"></script> #}
	{{ bundle('validate') }}
	{{ bundle('boot_select') }}
	{{ script('js/highcharts/highcharts.js') }}
	{{ script('js/highcharts/modules/exporting.js') }}
	{{ script('js/jquery.serialize-object.min.js') }}

	<script type="text/javascript">
        var app = new Vue({
            el: '#app',
            data: {
                datos: [],
                total: [],
                tipo_consulta: '',
                nombre: '',
                unidad: '',
                costo_actual: '',
                stock_actual: '',
            },
            watch: {},
            computed: {},
            methods: {
                consultar: function () {
                    if (($("#producto").val() == '') && ($("#material").val() == '')) {
                        alert("Seleccionar un Producto Terminado o Materiale e Insumo");
                    } else {
                        var form = $('#filtros');
                        var self = this;
                        var data = form.serializeArray();
                        toggleLoader();
                        $.post('{{ root }}/reportes/kardexMovimientos', data, function (res) {
                            toggleLoader();
                            self.datos = res['data'];
                            self.total = res['total'];
                            self.tipo_consulta = res['tipo_consulta'];
                            self.nombre = res['nombre'];
                            self.unidad = res['unidad'];
                            self.costo_actual = res['costo_actual'];
                            self.stock_actual = res['stock_actual'];
                        })
                    }
                }
            },
            mounted: function () {
                var form = $('#filtros');
                var self = this;
                $('#btnExportar').click(function () {
                    var data = {
                        filtros: form.serializeForm()
                    };
                    $('#json').val(JSON.stringify(data));
                    $('#exportForm').submit();
                });
                $('#btnExportarPdf').click(function () {
                    var data = {
                        filtros: form.serializeForm()
                    };
                    $('#jsonPdf').val(JSON.stringify(data));
                    $('#exportFormPdf').submit();
                });

                $(document).ready(function () {
                    $('#btnFiltro').click(function () {
                        self.consultar();
                    });
                    $('#btnTodos').click(function () {
                        form[0].reset();
                        self.consultar();
                    });
                });
            }
        });
	</script>
{% endblock %}